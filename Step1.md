# Step1

## Vagrant
### ハンズオン用ディレクトリの作成
HOST OS上の任意のディレクトリで`1day`ディレクトリを作成し、遷移しましょう。以降`1day`ディレクトリをカレントディレクトリとします。

```
$ mkdir 1day
$ cd 1day
```

### Vagrant設定ファイル(Vagrantfile)の作成
`Vagrantfile`が作成されること

```
$ vagrant init
$ ls -la
-rw-r--r--   1 miurahironori  staff  3008  9  7 17:24 Vagrantfile
```

### boxファイルの配布
インターネットからDLするとそれなりのサイズのため、ネットワーク環境に不安がある場合に限り、事前に渡したUSBの中にある　`centos/7`ディレクトリを指定したディレクトリにコピーしましょう

`~/.vagrant.d/boxes` ボックスファイルが格納されるディレクトリ    
`vagrant box list` ローカルで利用可能なボックスのリスト表示。今回`centos/7           (virtualbox, 1905.1)`が初回に表示されないこと    

```
$ vagrant box list

$ cp -R /Volumes/NO\ NAME/centos-VAGRANTSLASH-7 ~/.vagrant.d/boxes/.
$ vagrant box list
centos/7           (virtualbox, 1905.1)
```

### Vagrantfile編集
カレントディレクトリで`Vagrantfile`を以下の内容で編集しましょう
boxファイル`puppetlabs/centos-7.2-64-nocm`、IPアドレス `192.168.56.33`、VirtualBoxでのマシン名 `1day`、メモリ `768M`で設定

```
$ vi Vagrantfile

$ cat Vagrantfile
# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure("2") do |config|
  config.vm.box = "centos/7"
  config.vm.hostname = "1day.local"
  config.vm.network :private_network, ip: "192.168.56.50"
  config.vm.provider :virtualbox do |vb|
    vb.name = "1day"
    vb.customize ["modifyvm", :id, "--memory", "768"]
  end
end
```

### Vagrantによる仮想環境の起動(初回の作成)
`not created (virtualbox)`から`running (virtualbox)`となること

```
$ vagrant status
Current machine states:

default                   not created (virtualbox)

$ vagrant up

$ vagrant status
Current machine states:

default                   running (virtualbox)
```

### ssh-configの確認
今回のVagrant環境に接続する際の設定を確認する

```
$ vagrant ssh-config
Host default
  HostName 127.0.0.1
  User vagrant
  Port 2200
  UserKnownHostsFile /dev/null
  StrictHostKeyChecking no
  PasswordAuthentication no
  IdentityFile /Users/miurahironori/Vagrant/1/.vagrant/machines/default/virtualbox/private_key
  IdentitiesOnly yes
  LogLevel FATAL
```
### VirtualBoxでの確認
VirtualBoxのGUIコンソールで`1day`と言う仮想サーバが存在し「実行中」となっていることを確認する

### 接続とrootユーザ遷移
`vagrant ssh`にて仮想環境に`vagrant`ユーザでログインし`root`まで遷移できることを確認する

```
$ vagrant ssh
[vagrant@1day ~]$ who
vagrant  pts/0        2017-09-14 01:41 (10.0.2.2)
[vagrant@1day ~]$ sudo su -
最終ログイン: 2017/09/14 (木) 01:41:14 UTC 192.168.56.1から開始日時 pts/0
[root@1day ~]#
```

## 設定内容の確認
`enp0s8`に`Vagrantfile`で設定したIP`192.168.56.33`が設定されていること。デフォルトルータ`10.0.2.2`、DNSサーバ`10.0.2.3`についても確認する

```
[root@1day ~]# ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000
    link/ether 08:00:27:b7:f3:af brd ff:ff:ff:ff:ff:ff
    inet 10.0.2.15/24 brd 10.0.2.255 scope global dynamic enp0s3
       valid_lft 63945sec preferred_lft 63945sec
    inet6 fe80::a00:27ff:feb7:f3af/64 scope link
       valid_lft forever preferred_lft forever
3: enp0s8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000
    link/ether 08:00:27:27:cb:87 brd ff:ff:ff:ff:ff:ff
    inet 192.168.56.33/24 brd 192.168.56.255 scope global enp0s8
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fe27:cb87/64 scope link
       valid_lft forever preferred_lft forever

[root@1day ~]# ip r
default via 10.0.2.2 dev enp0s3  proto static  metric 100
10.0.2.0/24 dev enp0s3  proto kernel  scope link  src 10.0.2.15  metric 100
169.254.0.0/16 dev enp0s8  scope link  metric 1003
192.168.56.0/24 dev enp0s8  proto kernel  scope link  src 192.168.56.33

[root@1day ~]# cat /etc/resolv.conf
# Generated by NetworkManager
search hq-nw-qc.voyagegroup.local local
nameserver 10.0.2.3
```

`Mem:        758812`にて約768M確保されていることを確認

```
[root@1day ~]# free
              total        used        free      shared  buff/cache   available
Mem:         758812       89916      534236        5324      134660      549976
Swap:       1048572           0     1048572

[root@1day ~]# cat /proc/meminfo
MemTotal:         758812 kB
MemFree:          534236 kB
MemAvailable:     549996 kB
Buffers:             948 kB
Cached:           105660 kB
SwapCached:            0 kB
Active:           101816 kB
Inactive:          68732 kB
Active(anon):      64092 kB
Inactive(anon):     5172 kB
Active(file):      37724 kB
Inactive(file):    63560 kB
Unevictable:           0 kB
Mlocked:               0 kB
SwapTotal:       1048572 kB
SwapFree:        1048572 kB
Dirty:                 0 kB
Writeback:             0 kB
AnonPages:         63972 kB
Mapped:            22472 kB
Shmem:              5324 kB
Slab:              28072 kB
SReclaimable:      16904 kB
SUnreclaim:        11168 kB
KernelStack:        1840 kB
PageTables:         4380 kB
NFS_Unstable:          0 kB
Bounce:                0 kB
WritebackTmp:          0 kB
CommitLimit:     1427976 kB
Committed_AS:     333512 kB
VmallocTotal:   34359738367 kB
VmallocUsed:        9856 kB
VmallocChunk:   34359719420 kB
HardwareCorrupted:     0 kB
AnonHugePages:      4096 kB
HugePages_Total:       0
HugePages_Free:        0
HugePages_Rsvd:        0
HugePages_Surp:        0
Hugepagesize:       2048 kB
DirectMap4k:       51136 kB
DirectMap2M:      735232 kB
```
**Q.CPU数、Disk容量はいくつか調べてみましょう。(5分)**

#### 補足
直接rootでログインする場合(ただしこのインターンでは`vagrant ssh`で接続した前提で進める)  
パスワードは`puppet`

```
$ ssh root@192.168.56.50
root@192.168.56.50's password:
[root@1day ~]# exit
ログアウト
```

#### エディタのインストール
今後作業する上で使い慣れたエディタが良い人は必須ではありませんがインストールを行いましょう

- vim
```
# yum install -y vim
```

- emacs
```
# yum install -y emacs
```

### Git
Re:Dashの設定ファイルをクローンするため、gitのインストールを行いましょう
```
# yum install -y git
# git --version
git version 1.8.3.1
```

